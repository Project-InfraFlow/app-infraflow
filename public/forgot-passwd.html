<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link
    href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Nunito:ital,wght@0,200..1000;1,200..1000&family=Orbitron:wght@400..900&family=Permanent+Marker&family=Pixelify+Sans:wght@400..700&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Special+Gothic+Expanded+One&display=swap"
    rel="stylesheet">
    <link rel="stylesheet" href="./css/forgot-passwd.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">

    <title>Esqueci minha senha | InfraFlow</title>
</head>
<body>
    <div class="geral-container">
        <div class="imagem">
            <div class="btn-sair">
                <a href="./login.html" class="btn-exit"><i class="bi bi-arrow-left-circle-fill"></i></a>
            </div>
            <div class="img-senha">
                <img src="./assets/Forgot password-pana (1).svg" alt="">
            </div>
            <div class="img-logo">
                <img src="./assets/Infra-all-white.svg" alt="">
            </div>
        </div>
        <div class="texts">
    <!-- PASSO 1 -->
    <div class="passo" id="passo1">
        <div class="titulo">
            <p>Redefinir Senha</p>
            <div class="linha"></div>
        </div>
        <div class="input">
            <label for="email_user">Insira seu e-mail</label>
            <input type="text" id="email_user">
            <button class="btn_send_code" onclick="abrirPasso2()">Enviar Código</button>
        </div>
    </div>

    <!-- PASSO 2 -->
    <div class="passo" id="passo2" style="display: none;">
        <div class="titulo">
            <p>Verificação</p>
            <div class="linha"></div>
        </div>
        <div class="input">
            <label for="code">Insira o código enviado ao e-mail</label>
            <input type="text" id="code">
            <button class="btn_send_code" onclick="abrirPasso3()">Confirmar Código</button>
        </div>
    </div>

    <!-- PASSO 3 -->
    <div class="passo" id="passo3" style="display: none;">
        <div class="titulo">
            <p>Nova Senha</p>
            <div class="linha"></div>
        </div>
        <div class="input">
            <label for="nova_senha">Nova senha</label>
            <input type="password" id="nova_senha">

            <label for="confirmar_senha">Confirmar senha</label>
            <input type="password" id="confirmar_senha">

            <button class="btn_send_code" onclick="finalizar()">Redefinir Senha</button>
        </div>
    </div>
</div>
    </div>
</body>
</html>

<script>
function abrirPasso2() {



    const email = document.getElementById("email_user");

    if (email.value === "") {
        alert("Insira um e-mail válido.");
        return;
    }

    document.getElementById("passo1").style.display = "none";
    document.getElementById("passo2").style.display = "block";
}

function abrirPasso3() {
    const code = document.getElementById("code");

    if (code.value === "") {
        alert("Digite o código recebido.");
        return;
    }

    document.getElementById("passo2").style.display = "none";
    document.getElementById("passo3").style.display = "block";
}

function finalizar() {
    const senha = document.getElementById("nova_senha").value;
    const confirmar = document.getElementById("confirmar_senha").value;

    if (senha === "" || confirmar === "") {
        alert("Preencha todas as senhas.");
        return;
    }

    if (senha !== confirmar) {
        alert("As senhas não coincidem!");
        return;
    }

    alert("Senha redefinida com sucesso!");
   
    window.location.href = "./login.html";
}

async function abrirPasso2() {
    const emailInput = document.getElementById("email_user");
    const email = emailInput.value?.trim();

    if (!email) {
        alert("Insira um e-mail válido.");
        return;
    }
    
   
    fetch("/usuarios/enviar-codigo-reset", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ email: email }) // Apenas o e-mail
    })
    .then(function (resposta) {
        
        if (!resposta.ok) {
            return resposta.text().then(function (t) { throw new Error(t || "Erro na requisição."); });
        }
        return resposta.json();
    })
    .then(function (json) {
       
        

        alert("Se o e-mail estiver cadastrado, um código foi enviado para redefinição de senha.");
        
    
        document.getElementById("passo1").style.display = "none";
        document.getElementById("passo2").style.display = "block";
    })
    .catch(function (erro) {
       
        console.error('Erro:', erro);
        alert("Erro ao tentar enviar o código. Tente novamente mais tarde.");
    });
}
</script>
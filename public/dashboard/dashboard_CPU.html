<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>InfraFlow - Sistema de Monitoramento</title>
    <link rel="stylesheet" href="../css/cpu.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body>

    <div id="dashboard" class="dashboard">
        <aside class="sidebar">

            <nav class="nav">
                <button data-view="overview" class="nav-item active">
                    <i class="fas fa-gauge"></i>
                    <span>Painel</span>
                </button>
                <button data-view="monitor" class="nav-item">
                    <i class="fas fa-chart-line"></i>
                    <span>Monitoramento</span>
                </button>
                <button data-view="cadastro" class="nav-item">
                    <i class="fas fa-pen-to-square"></i>
                    <span>Cadastro</span>
                </button>
                <button data-view="historico" class="nav-item">
                    <i class="fas fa-clock-rotate-left"></i>
                    <span>Histórico de Alertas</span>
                </button>
            </nav>

            <div class="divider"></div>

            <div class="user-section">
                <div class="user-info">
                    <i class="fas fa-user-circle"></i>
                    <span id="sidebarUser">Admin</span>
                </div>
                <button class="logout-btn" id="logoutBtn">
                    <i class="fas fa-sign-out-alt"></i>
                </button>
            </div>
        </aside>

        <main class="content">
            <header class="topbar">
                <div class="brand">
                    <img src="../assets/infra-parafundobranco.png">
                </div>
                <div class="topbar-left">
                    <div class="machine-select">
                        <i class="fas fa-server"></i>
                        <label for="edgeSelector"
                            style="display:block; font-size:14px; margin-bottom:4px; color: gray;">
                            Selecione um pórtico FreeFlow:
                        </label>
                        <select id="edgeSelector">
                            <option value="INFRA-EDGE-01-Itápolis (SP-333)">INFRA-EDGE-01-Itápolis (SP-333)</option>
                            <option value="INFRA-EDGE-02-Jaboticabal (SP-333)">INFRA-EDGE-02-Jaboticabal (SP-333)
                            </option>
                            <option value="INFRA-EDGE-03-São José dos Campos (SP-099)">INFRA-EDGE-03-São José dos Campos
                                (SP-099)
                            </option>
                            <option value="INFRA-EDGE-04-Itaguaí (Km 414)">INFRA-EDGE-04-Itaguaí (Km 414)</option>
                        </select>
                    </div>
                    <div class="os-info">
                        <i class="fab fa-ubuntu"></i>
                        <span>Ubuntu 22.04 LTS</span>
                    </div>
                </div>
                <div class="topbar-right">
                    <div class="status-indicator">
                        <div class="status-dot"></div>
                        <span>Online</span>
                    </div>
                    <div class="last-update">
                        <span class="update-label">Última atualização:</span>
                        <span class="update-time" id="lastUpdateTime">--:--:--</span>
                    </div>
                </div>
            </header>

            <section id="view-overview" class="view active">
                <div class="view-header">
                    <h1 class="view-title">
                        <i class="fas fa-microchip"></i>
                        CPU <span id="monitor-selecionado"></span>

                        <span class="slack-icon" id="btnSlack">
                            <img src="../assets/icon/Slack_icon.png">
                        </span>
                    </h1>
                </div>

                <div class="kpis-grid">
                    <div class="kpi-card" id="kpiCpu">
                        <div class="kpi-header">
                            <div class="kpi-icon cpu">
                                <i class="fas fa-microchip"></i>
                            </div>
                            <div class="kpi-info">
                                <span class="kpi-label">Utilização por núcleo</span>
                            </div>
                        </div>
                        <div class="kpi-value" id="kpiCpuValue">80%</div>
                        <div class="kpi-progress">
                            <div class="progress-bar cpu" id="cpuProgress"></div>
                        </div>
                    </div>

                    <div class="kpi-card" id="KpiProcessos">
                        <div class="kpi-header">
                            <div class="kpi-icon processos">
                                <i class="fas fa-cogs"></i>
                            </div>
                            <div class="kpi-info">
                                <span class="kpi-label">Processos em execução</span>
                            </div>
                        </div>
                        <div class="kpi-value" id="KpiProcessosValue">213</div>
                        <div class="kpi-progress">
                            <div class="progress-bar processos" id="processosProgress"></div>
                        </div>
                    </div>

                    <div class="kpi-card" id="KpiLatencia">
                        <div class="kpi-header">
                            <div class="kpi-icon latencia">
                                <i class="fas fa-stopwatch"></i>
                            </div>
                            <div class="kpi-info">
                                <span class="kpi-label">Latencia</span>
                            </div>
                        </div>
                        <div class="kpi-value" id="KpiLatenciaValue">215 ms</div>
                        <div class="kpi-progress">
                            <div class="progress-bar latencia" id="latenciaProgress"></div>
                        </div>
                    </div>

                    <div class="kpi-card" id="kpiRede">
                        <div class="kpi-header">
                            <div class="kpi-icon rede">
                                <i class="fas fa-triangle-exclamation"></i>
                            </div>
                            <div class="kpi-info">
                                <span class="kpi-label">Total de alertas CPU</span>
                            </div>
                        </div>
                        <div class="kpi-value" id="kpiRedeValue">8</div>
                        <div class="kpi-progress">
                            <div class="progress-bar rede" id="redeProgress"></div>
                        </div>
                    </div>
                </div>

                <div class="charts-grid">
                    <div class="chart-container">
                        <div class="chart-header">
                            <h3 class="chart-title">
                                <i class="fas fa-chart-line"></i>
                                CPU x Latência
                            </h3>
                            <canvas id="cpuLatenciaChart"></canvas>
                        </div>
                        <div class="chart-content">
                            <canvas id="cpuLatencyChart"></canvas>
                        </div>
                    </div>

                    <div class="chart-container">
                        <div class="chart-header">
                            <h3 class="chart-title">
                                <i class="fas fa-microchip"></i>
                                Processos em Execução
                            </h3>
                            <canvas id="processosChart"></canvas>
                        </div>
                        <div class="chart-content">
                            <canvas id="processChart"></canvas>
                        </div>
                    </div>
                </div>

            </section>

            <section id="view-monitor" class="view">
                <div class="view-header">
                    <h1 class="view-title">
                        <i class="fas fa-chart-line"></i>
                        Monitoramento (Histórico de Registros)
                    </h1>
                </div>

                <div class="table-section">
                    <div class="table-header">
                        <h3 class="table-title">
                            <i class="fas fa-table"></i>
                            Últimas Leituras
                        </h3>
                        <div class="table-actions">
                            <button id="exportMonitorCsv" class="btn btn-export">
                                <i class="fas fa-download"></i>
                                Exportar CSV
                            </button>
                        </div>
                    </div>
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th><i class="fas fa-server"></i> Pórtico</th>
                                    <th><i class="fas fa-clock"></i> Horário</th>
                                    <th><i class="fas fa-microchip"></i> CPU (%)</th>
                                    <th><i class="fas fa-memory"></i> Memória (%)</th>
                                    <th><i class="fas fa-hdd"></i> Disco (%)</th>
                                    <th><i class="fas fa-network-wired"></i> Rede (Mbps)</th>
                                </tr>
                            </thead>
                            <tbody id="monitorTableBody">
                            </tbody>
                        </table>
                    </div>
                    <div class="table-pagination">
                        <div class="pagination-info">
                            <span id="monitorPaginationInfo">Mostrando 0 de 0 registros</span>
                        </div>
                        <div class="pagination-controls">
                            <button id="monitorPrevPage" class="btn btn-pagination" disabled>
                                <i class="fas fa-chevron-left"></i>
                                Anterior
                            </button>
                            <span id="monitorPageInfo">Página 0 de 0</span>
                            <button id="monitorNextPage" class="btn btn-pagination" disabled>
                                Próxima
                                <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <section id="view-cadastro" class="view">
                <div class="view-header">
                    <h1 class="view-title">
                        <i class="fas fa-pen-to-square"></i>
                        Cadastro
                    </h1>
                </div>

                <div class="cadastro-tabs">
                    <button class="tab-btn active" data-tab="usuario">
                        <i class="fas fa-user"></i>
                        Usuário
                    </button>
                    <button class="tab-btn" data-tab="maquina">
                        <i class="fas fa-server"></i>
                        Máquina
                    </button>
                </div>

                <div class="cadastro-content">
                    <div id="tab-usuario" class="tab-content active">
                        <form class="cadastro-form" id="usuarioForm">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="usuarioNome">Nome</label>
                                    <input type="text" id="usuarioNome" required>
                                </div>
                                <div class="form-group">
                                    <label for="usuarioEmail">E-mail</label>
                                    <input type="email" id="usuarioEmail" required>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="usuarioTipo">Tipo</label>
                                    <select id="tipo_permissao" required>
                                        <option value="0">Selecione uma opção</option>
                                        <option value="1">Administrador</option>
                                        <option value="2">Comum</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="usuarioSenha">Senha</label>
                                    <input type="password" id="usuarioSenha" required>
                                </div>
                            </div>
                            <div class="form-actions">
                                <button type="submit" onclick="cadastrarUser()" class="btn btn-primary">
                                    <i class="fas fa-save"></i>
                                    Salvar
                                </button>
                                <button type="reset" class="btn btn-secondary">
                                    <i class="fas fa-times"></i>
                                    Cancelar
                                </button>
                            </div>
                        </form>

                        <div class="listar-users">
                            <div class="titulo">
                                <i class="bi bi-person-fill-add controlador"></i>
                                <h1>Usuários Cadastrados</h1>
                            </div>

                            <div class="barra-infos">
                                <p>ID</p>
                                <p>Nome</p>
                                <p>Email</p>
                                <p>Acesso</p>
                                <p>Ações</p>
                            </div>

                            <div class="infos-user">
                                <p>1</p>
                                <p>Vinicius Melo</p>
                                <p>viniciusmelo@ecorodovias.com</p>
                                <p>Comum</p>
                                <div class="acoes">
                                    <button onclick="edit_user()" class="btn_actions"><i
                                            class="bi bi-pencil-square"></i></button>
                                    <button onclick="delete_user()" class="btn_actions"><i
                                            class="bi bi-trash3-fill"></i></button>
                                </div>
                            </div>

                            <div class="infos-user">
                                <p>2</p>
                                <p>Rafael Brandão</p>
                                <p>rafaelbrandão@ecorodovias.com</p>
                                <p>Comum</p>
                                <div class="acoes">
                                    <button onclick="edit_user()" class="btn_actions"><i
                                            class="bi bi-pencil-square"></i></button>
                                    <button onclick="delete_user()" class="btn_actions"><i
                                            class="bi bi-trash3-fill"></i></button>
                                </div>
                            </div>

                            <div class="infos-user">
                                <p>3</p>
                                <p>Mariana Silva</p>
                                <p>marianasilva@ecorodovias.com</p>
                                <p>Comum</p>
                                <div class="acoes">
                                    <button onclick="edit_user()" class="btn_actions"><i
                                            class="bi bi-pencil-square"></i></button>
                                    <button onclick="delete_user()" class="btn_actions"><i
                                            class="bi bi-trash3-fill"></i></button>
                                </div>
                            </div>

                            <div class="infos-user">
                                <p>4</p>
                                <p>Marcelo Noronha</p>
                                <p>marcelonoronha@ecorodovias.com</p>
                                <p>Comum</p>
                                <div class="acoes">
                                    <button onclick="edit_user()" class="btn_actions"><i
                                            class="bi bi-pencil-square"></i></button>
                                    <button onclick="delete_user()" class="btn_actions"><i
                                            class="bi bi-trash3-fill"></i></button>
                                </div>
                            </div>

                            <div class="infos-user">
                                <p>5</p>
                                <p>Vivian Silva</p>
                                <p>viviansilva@ecorodovias.com</p>
                                <p>Comum</p>
                                <div class="acoes">
                                    <button onclick="edit_user()" class="btn_actions"><i
                                            class="bi bi-pencil-square"></i></button>
                                    <button onclick="delete_user()" class="btn_actions"><i
                                            class="bi bi-trash3-fill"></i></button>
                                </div>

                            </div>
                        </div>

                    </div>

                    <div id="tab-maquina" class="tab-content">
                        <form class="cadastro-form" id="maquinaForm">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="maquinaNome">Nome</label>
                                    <input type="text" id="maquinaNome" required>
                                </div>
                                <div class="form-group">
                                    <label for="maquinaSo">Sistema Operacional</label>
                                    <input type="text" id="maquinaSo" required>
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="maquinaLocalizacao">Localização</label>
                                    <input type="text" id="maquinaLocalizacao" required>
                                </div>
                                <div class="form-group">
                                    <label for="maquinaKm">KM</label>
                                    <input type="number" id="maquinaKm" step="0.1">
                                </div>
                            </div>

                            <div class="form-actions">
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-save"></i>
                                    Salvar
                                </button>
                                <button type="reset" class="btn btn-secondary">
                                    <i class="fas fa-times"></i>
                                    Cancelar
                                </button>
                            </div>
                        </form>

                        <div class="listar-maquinas">
                            <div class="titulo">
                                <i class="bi bi-hdd-stack controlador"></i>
                                <h1>Pórticos Cadastrados</h1>
                            </div>

                            <div class="barra-infos-maq">
                                <p>ID</p>
                                <p>Nome</p>
                                <p>Sistema Op.</p>
                                <p>Localização</p>
                                <p>KM</p>
                                <p>Ações</p>
                            </div>

                            <div class="infos-maquina">
                                <p>1</p>
                                <p>INFRA-EDGE-01-Itápolis</p>
                                <p>Ubuntu 22.04</p>
                                <p>SP-333</p>
                                <p>101</p>
                                <div class="acoes">
                                    <button onclick="edit_user()" class="btn_actions"><i
                                            class="bi bi-pencil-square"></i></button>
                                    <button onclick="delete_user()" class="btn_actions"><i
                                            class="bi bi-trash3-fill"></i></button>
                                </div>
                            </div>

                            <div class="infos-maquina">
                                <p>2</p>
                                <p>INFRA-EDGE-02-Jaboticabal</p>
                                <p>Ubuntu 22.04</p>
                                <p>SP-099</p>
                                <p>15</p>
                                <div class="acoes">
                                    <button onclick="edit_user()" class="btn_actions"><i
                                            class="bi bi-pencil-square"></i></button>
                                    <button onclick="delete_user()" class="btn_actions"><i
                                            class="bi bi-trash3-fill"></i></button>
                                </div>
                            </div>

                            <div class="infos-maquina">
                                <p>3</p>
                                <p>INFRA-EDGE-03-São José dos Santos</p>
                                <p>Ubuntu 22.04</p>
                                <p>KM-414</p>
                                <p>414</p>
                                <div class="acoes">
                                    <button onclick="edit_user()" class="btn_actions"><i
                                            class="bi bi-pencil-square"></i></button>
                                    <button onclick="delete_user()" class="btn_actions"><i
                                            class="bi bi-trash3-fill"></i></button>
                                </div>
                            </div>

                            <div class="infos-maquina">
                                <p>4</p>
                                <p>INFRA-EDGE-04-Itaguaí</p>
                                <p>Ubuntu 22.04</p>
                                <p>SP-050</p>
                                <p>221</p>
                                <div class="acoes">
                                    <button onclick="edit_user()" class="btn_actions"><i
                                            class="bi bi-pencil-square"></i></button>
                                    <button onclick="delete_user()" class="btn_actions"><i
                                            class="bi bi-trash3-fill"></i></button>
                                </div>
                            </div>

                        </div>
                    </div>

                </div>
            </section>

            <section id="view-historico" class="view">
                <div class="view-header">
                    <h1 class="view-title">
                        <i class="fas fa-clock-rotate-left"></i>
                        Histórico de Alertas
                    </h1>
                </div>

                <div class="filters-section">
                    <div class="filter-group">
                        <label for="historicoPeriodo">Período</label>
                        <select id="historicoPeriodo">
                            <option value="5min">Últimos 5 minutos</option>
                            <option value="1h" selected>Última 1 hora</option>
                            <option value="24h">Últimas 24 horas</option>
                            <option value="custom">Personalizado</option>
                        </select>
                    </div>
                    <div class="filter-group custom-period" id="customPeriodInputs" style="display: none;">
                        <div class="period-inputs">
                            <div class="period-input">
                                <label for="historicoInicio">Início</label>
                                <input type="datetime-local" id="historicoInicio">
                            </div>
                            <div class="period-input">
                                <label for="historicoFim">Fim</label>
                                <input type="datetime-local" id="historicoFim">
                            </div>
                        </div>
                    </div>
                    <button id="aplicarFiltroHistorico" class="btn btn-primary">
                        <i class="fas fa-filter"></i>
                        Aplicar Filtro
                    </button>
                </div>

                <div class="kpis-historico">
                    <div class="kpi-card">
                        <h4>Alertas no Período</h4>
                        <p>36</p>
                    </div>
                    <div class="kpi-card">
                        <h4>Horário de Pico de Utilização</h4>
                        <p>17h às 18h • Maior carga simultânea registrada</p>
                        <small style="display:block;font-size:12px;color:#64748b;margin-top:4px">
                            CPU média 82% • Rede 96 Mbps - Tráfego intenso em 2 pórticos
                        </small>
                    </div>
                    <div class="kpi-card">
                        <h4>Pórticos Afetados</h4>
                        <p>2 de 4</p>
                    </div>
                </div>

                <div class="chart-container">
                    <div class="chart-header">
                        <h3 class="chart-title">
                            <i class="fas fa-chart-area"></i>
                            Alertas
                        </h3>
                    </div>
                    <div class="chart-content">
                        <canvas id="historicalChart"></canvas>
                    </div>
                </div>

                <div class="table-section">
                    <div class="table-header">
                        <h3 class="table-title">
                            <i class="fas fa-list"></i>
                            Ocorrências
                        </h3>
                        <div class="table-actions">
                            <button id="exportHistoricoCsv" class="btn btn-export">
                                <i class="fas fa-download"></i>
                                Exportar CSV
                            </button>
                        </div>
                    </div>
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th><i class="fas fa-server"></i> Pórtico</th>
                                    <th><i class="fas fa-clock"></i> Período</th>
                                    <th><i class="fas fa-microchip"></i> CPU (%)</th>
                                    <th><i class="fas fa-memory"></i> Memória (%)</th>
                                    <th><i class="fas fa-hdd"></i> Disco (%)</th>
                                    <th><i class="fas fa-network-wired"></i> Rede (Mbps)</th>
                                    <th><i class="fas fa-clipboard-check"></i> Ação/Laudo</th>
                                </tr>
                            </thead>
                            <tbody id="historicoTableBody">
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <div class="slack-painel" id="slackpainel">
                <div class="slack-painel-header">
                    <h4>Alertas Ativos (Todos os Pórticos)</h4>
                    <button id="closeSlack" class="close-slack">×</button>
                </div>

                <div class="slack-painel-body">
                    <!-- Aqui você coloca sua lista de alertas -->
                    <p>Carregando alertas CPU...</p>
                </div>
            </div>
        </main>
    </div>

    <script src="../js/exemplo.js"></script>
    <script src="../js/cpu.js"></script>

    <script>

        document.getElementById("logoutBtn").addEventListener("click", function () {
            window.location.href = "login.html";
        });

        const select = document.getElementById("edgeSelector");
        const spanMonitor = document.getElementById("monitor-selecionado");

        function atualizarMonitor() {
            spanMonitor.textContent = `– ${select.value}`;
        }

        select.addEventListener("change", atualizarMonitor);

        atualizarMonitor();

        const slackBtn = document.getElementById("btnSlack");
        const slackpainel = document.getElementById("slackpainel");
        const closeSlack = document.getElementById("closeSlack");

        slackBtn.addEventListener("click", () => {
            slackpainel.classList.add("open");
        });

        closeSlack.addEventListener("click", () => {
            slackpainel.classList.remove("open");
        });
    </script>
</body>

</html>